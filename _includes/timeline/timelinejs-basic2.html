<script src="{{ '/assets/lib/timeline3/js/timeline-min.js' | relative_url }}"></script>
<script>
/* add timeline events to json style object */
{%- assign field-map = site.data.timeline-map-basic | where_exp: 'f','f.csv_field' -%}
{%- assign objects = field-map | map: 'object' | uniq -%}
{%- assign timeline = site.data[page.timeline] -%}
{%- assign title = timeline | where: 'Type','title' | first -%}
{%- assign events = timeline | where_exp: 'f','f.Type != "title"' -%}
var timelineEvents = {
    {% if title %}
    /* add title slide if available */
    "title": {
        {% if title['Media'] %}"media": {
            {% if title['Media Caption'] %}"caption": {{ title['Media Caption'] | markdownify | jsonify }},{% endif %}
            {% if title['Media Credit'] %}"credit": {{ title['Media Credit'] | markdownify | jsonify }},{% endif %}
            "url": "{{ title['Media'] | absolute_url }}"
        },{% endif %}
        "text": {
            "headline": {{ title['Headline'] | markdownify | jsonify }},
            "text": {{ title['Text'] | markdownify | jsonify }}
        }
    },
    {%- endif -%}
    
    "events": [
        {% for event in events %}{
            {% for object in objects %}{% assign fields = field-map | where: 'object',object %}
            "{{ object }}": {% if fields[0].key == "false" %}{{ event[fields[0].csv_field] | jsonify }}{% else %} 
                {
                    {% for f in fields %} 
                    "{{ f.key }}": {{ event[f.csv_field] | jsonify }}{% unless forloop.last %},{% endunless %}
                    {% endfor %} 
                }{% endif %}{% unless forloop.last %},{% endunless %}
            {% endfor %}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
            
    ]
};
</script>
<script type="text/javascript">
    // The TL.Timeline constructor takes at least two arguments:
    // the id of the Timeline container (no '#'), and
    // the URL to your JSON data file or Google spreadsheet.
    // the id must refer to an element "above" this code,
    // and the element must have CSS styling to give it width and height
    // optionally, a third argument with configuration options can be passed.
    // See below for more about options.
    timeline = new TL.Timeline('{{ page.timeline }}', timelineEvents);
</script>
